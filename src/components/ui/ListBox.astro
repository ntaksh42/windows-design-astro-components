---
/**
 * ListBox - Windows Forms風のリストボックス
 */
interface Props {
  /** リスト項目の配列 */
  items?: string[];
  /** 選択可能な項目数（1: 単一選択, 複数: 複数選択） */
  selectionMode?: 'single' | 'multiple';
  /** 高さ（px） */
  height?: number;
  /** 幅（px） */
  width?: number;
  /** 無効化 */
  disabled?: boolean;
  /** name属性 */
  name?: string;
}

const {
  items = [],
  selectionMode = 'single',
  height = 200,
  width = 200,
  disabled = false,
  name
} = Astro.props;
---

<div
  class={`listbox-container ${disabled ? 'listbox-disabled' : ''}`}
  style={`height: ${height}px; width: ${width}px;`}
>
  <div class="listbox-items">
    {items.map((item, index) => (
      <div class="listbox-item" data-value={item} data-index={index}>
        {item}
      </div>
    ))}
    <slot />
  </div>
</div>

<script>
  document.addEventListener('astro:page-load', () => {
    const listboxes = document.querySelectorAll('.listbox-container:not(.listbox-disabled)');

    listboxes.forEach((listbox) => {
      const items = listbox.querySelectorAll('.listbox-item');
      const isSingle = !listbox.classList.contains('listbox-multiple');

      items.forEach((item) => {
        item.addEventListener('click', (e) => {
          if (isSingle) {
            // 単一選択: 他の選択を解除
            items.forEach(i => i.classList.remove('listbox-item-selected'));
            item.classList.add('listbox-item-selected');
          } else {
            // 複数選択: トグル
            item.classList.toggle('listbox-item-selected');
          }
        });
      });
    });
  });
</script>

<style>
  .listbox-container {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    font-size: 13px;
    border: 1px solid #7f9db9;
    background: #fff;
    overflow-y: auto;
    overflow-x: auto;
    user-select: none;
    box-shadow: inset 1px 1px 2px rgba(0, 0, 0, 0.05);
  }

  .listbox-items {
    display: flex;
    flex-direction: column;
  }

  .listbox-item {
    padding: 2px 4px;
    cursor: pointer;
    white-space: nowrap;
    min-height: 18px;
    display: flex;
    align-items: center;
  }

  .listbox-item:hover:not(.listbox-item-selected) {
    background: #e5f3ff;
  }

  .listbox-item-selected {
    background: #0078d4;
    color: #fff;
  }

  .listbox-item-selected:hover {
    background: #005a9e;
  }

  /* フォーカス */
  .listbox-container:focus-within {
    border-color: #0078d4;
    outline: 1px dotted #000;
    outline-offset: -2px;
  }

  /* 無効化 */
  .listbox-disabled {
    background: #f0f0f0;
    border-color: #d0d0d0;
    color: #a0a0a0;
    cursor: not-allowed;
  }

  .listbox-disabled .listbox-item {
    cursor: not-allowed;
    color: #a0a0a0;
  }

  .listbox-disabled .listbox-item:hover {
    background: transparent;
  }

  /* スクロールバー（Windows風） */
  .listbox-container::-webkit-scrollbar {
    width: 17px;
    height: 17px;
  }

  .listbox-container::-webkit-scrollbar-track {
    background: #f0f0f0;
    border-left: 1px solid #d4d4d4;
  }

  .listbox-container::-webkit-scrollbar-thumb {
    background: linear-gradient(to right, #f0f0f0 0%, #e5e5e5 100%);
    border: 1px solid #adadad;
  }

  .listbox-container::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(to right, #e5f3ff 0%, #d0e9ff 100%);
    border-color: #3c7fb1;
  }

  .listbox-container::-webkit-scrollbar-thumb:active {
    background: linear-gradient(to right, #cce4f7 0%, #b8d6ed 100%);
    border-color: #2c5f8d;
  }
</style>
