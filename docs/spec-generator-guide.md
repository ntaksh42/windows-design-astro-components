# AI仕様書生成ツール - 使用ガイド

## 概要

このツールは、**自然言語での簡単な説明から、PCアプリケーション風の詳細な外部仕様書を自動生成**します。

従来の手動での仕様書作成と比較して、以下のメリットがあります：

- ⏱️ **工数削減**: 数時間かかる仕様書作成が数分に
- 📝 **品質向上**: 項目の記載漏れを防止
- 🔄 **一貫性**: すべての仕様書が同じフォーマットに
- 🎯 **具体性**: 実用的なコード例が自動生成される

---

## セットアップ

### 1. 依存関係のインストール

```bash
npm install
```

これにより、`tsx`（TypeScript実行ツール）と関連パッケージがインストールされます。

### 2. （オプション）Claude APIキーの設定

より高品質な仕様書を生成するには、Claude APIキーを設定します：

```bash
# .envファイルに追加
echo "ANTHROPIC_API_KEY=your_api_key_here" >> .env
```

**APIキーがない場合でも動作します**（ローカルテンプレートを使用）。

---

## 基本的な使い方

### コマンド形式

```bash
npm run spec:generate <コンポーネント名> <説明> [カテゴリー] [参考コンポーネント]
```

### 例1: 最小限の情報で生成

```bash
npm run spec:generate "ScrollBar" "縦横両対応のスクロールバー"
```

これだけで、以下の内容を含む詳細な仕様書が生成されます：

- 概要・目的
- 外観仕様（デザイン説明、デザイントークン）
- プロパティ仕様（一覧表、詳細説明）
- バリエーション仕様
- 状態仕様（hover, active, disabled等）
- 動作仕様（ユーザー操作、キーボード操作）
- 実装例（基本、実用例、よくあるパターン）
- アクセシビリティ仕様
- 制約事項・注意事項
- 実装メモ（CSS、TypeScript）

### 例2: カテゴリーを指定

```bash
npm run spec:generate "DatePicker" "日付選択コンポーネント" "form"
```

カテゴリー（`ui`, `layout`, `form`, `feedback`）を指定すると、それに応じた内容が生成されます。

### 例3: 既存コンポーネントを参考にする

```bash
npm run spec:generate "SearchBox" "検索用テキストボックス" "form" "TextBox"
```

既存の`TextBox`コンポーネントのデモページと実装を参考に、類似した構造の仕様書が生成されます。

---

## 生成される仕様書の構造

### ファイル出力先

```
src/pages/<コンポーネント名>-demo.mdx
```

例: `ScrollBar` → `src/pages/scrollbar-demo.mdx`

### 仕様書の章立て

```markdown
1. 概要
   1.1 目的
   1.2 対象ユーザー
   1.3 主要機能

2. 外観仕様
   2.1 基本デザイン
   2.2 デザイントークン

3. プロパティ仕様
   3.1 プロパティ一覧
   3.2 プロパティ詳細

4. バリエーション仕様

5. 状態仕様
   5.1 状態遷移
   5.2 各状態の外観

6. 動作仕様
   6.1 ユーザー操作
   6.2 キーボード操作
   6.3 イベント仕様

7. 実装例
   7.1 基本的な使用例
   7.2 実用例
   7.3 よくある組み合わせ

8. アクセシビリティ
   8.1 ARIA属性
   8.2 キーボードナビゲーション
   8.3 スクリーンリーダー対応

9. 制約事項・注意事項
   9.1 技術的制約
   9.2 使用上の注意
   9.3 既知の問題

10. 参考情報
    10.1 関連コンポーネント
    10.2 参考リンク

付録: 実装メモ
   - CSS実装のポイント
   - TypeScript実装のポイント
```

この構造は、**Windows Forms等のPCアプリケーション外部仕様書のベストプラクティス**に基づいています。

---

## ワークフロー

### 推奨される開発フロー

```
1. 仕様書の自動生成
   ↓
2. 生成された内容をレビュー
   ↓
3. 必要に応じて手動で追記・修正
   ↓
4. コンポーネント本体を実装 (src/components/ui/)
   ↓
5. 開発サーバーで確認
   ↓
6. 仕様書と実装の整合性を最終確認
```

### 例: ScrollBarコンポーネントを作成する場合

```bash
# ステップ1: 仕様書生成
npm run spec:generate "ScrollBar" "縦横両対応のスクロールバー、マウスホイール対応"

# ステップ2: 仕様書を開いてレビュー
# → src/pages/scrollbar-demo.mdx を確認
# → 必要に応じて修正

# ステップ3: コンポーネント実装
# → src/components/ui/ScrollBar.astro を作成
# → 生成された仕様書の「実装メモ」セクションを参考に

# ステップ4: 開発サーバーで確認
npm run dev
# → http://localhost:4321/scrollbar-demo にアクセス

# ステップ5: 仕様書を実装に合わせて微調整
```

---

## 高度な使い方

### AIによる高品質生成（Claude API使用）

環境変数`ANTHROPIC_API_KEY`を設定すると、Claude APIを使用してより詳細で具体的な仕様書が生成されます。

**生成内容の違い:**

| 項目 | ローカルテンプレート | Claude API |
|------|---------------------|-----------|
| プロパティの詳細度 | 一般的な説明 | コンポーネント特有の詳細説明 |
| コード例 | 基本的なもののみ | 実用的なパターンを複数 |
| アクセシビリティ | 一般論 | 具体的なARIA属性とベストプラクティス |
| デザイントークン | 汎用的な値 | コンポーネントに最適化された値 |

### 既存仕様書を参考にした生成

既に作成済みの類似コンポーネントがある場合、そのデモページと実装を参考にすることで、プロジェクト固有のスタイルを維持できます。

```bash
# TextBoxを参考にSearchBoxを作成
npm run spec:generate "SearchBox" "検索用入力欄" "form" "TextBox"
```

AIは以下の情報を参考にします：

- `src/pages/textbox-demo.mdx`（仕様書のスタイル）
- `src/components/ui/TextBox.astro`（実装パターン）

---

## トラブルシューティング

### Q1: "ANTHROPIC_API_KEY環境変数が設定されていません"と表示される

**A:** Claude APIキーが未設定です。以下の対処法があります：

1. **APIキーを設定する**（推奨）
   ```bash
   export ANTHROPIC_API_KEY=your_api_key_here
   ```

2. **ローカルテンプレートで続行する**
   - APIキーなしでも動作します（品質は低下）
   - スクリプトが自動的にフォールバックします

### Q2: 生成された仕様書の内容が不足している

**A:** 以下を試してください：

1. より詳細な説明を与える
   ```bash
   # 悪い例
   npm run spec:generate "Slider" "スライダー"

   # 良い例
   npm run spec:generate "Slider" "値を選択するスライダー、範囲指定可能、ツールチップ表示"
   ```

2. 参考コンポーネントを指定
   ```bash
   npm run spec:generate "Slider" "..." "ui" "ProgressBar"
   ```

3. 生成後に手動で追記

### Q3: TypeScriptの型エラーが出る

**A:** 依存関係を再インストールしてください：

```bash
rm -rf node_modules package-lock.json
npm install
```

### Q4: 生成されたコード例が動作しない

**A:** 生成されたコード例は**ドラフト**です。以下を確認してください：

1. プロパティ名が実際の実装と一致しているか
2. 必須プロパティが指定されているか
3. Astroの文法に準拠しているか

必要に応じて手動で修正してください。

---

## ベストプラクティス

### ✅ DO（推奨）

- **詳細な説明を与える**: 「検索ボックス」より「検索用テキストボックス、虫眼鏡アイコン付き、クリアボタン付き」
- **既存コンポーネントを参考にする**: 統一感のある仕様書に
- **生成後にレビューする**: AIが生成した内容を必ず確認
- **段階的に修正**: 大枠はAIに任せ、細部を人間が調整

### ❌ DON'T（非推奨）

- **曖昧な説明**: 「便利なコンポーネント」等
- **生成結果をそのまま使用**: 必ずレビューを
- **APIキーをGitに含める**: 環境変数で管理
- **すべて手動で書く**: まずAI生成を試す

---

## 仕様書の品質を高めるコツ

### 1. 説明に具体性を持たせる

```bash
# 悪い例
npm run spec:generate "Input" "入力欄"

# 良い例
npm run spec:generate "Input" "一行テキスト入力欄、プレースホルダー対応、バリデーションエラー表示機能付き"
```

### 2. 既存の類似コンポーネントを活用

```bash
# ButtonをベースにIconButtonを作成
npm run spec:generate "IconButton" "アイコンのみのボタン、ツールチップ付き" "ui" "Button"
```

### 3. 生成後に追加すべき内容

AIが生成した仕様書に、以下を追記するとより良くなります：

- **実際のスクリーンショット**: `<img>`タグで追加
- **実装時の注意点**: 実装中に気づいた点を追記
- **パフォーマンス考慮事項**: 重いコンポーネントの場合
- **ブラウザ互換性**: 特定のブラウザで動作しない場合

---

## さらなる改善アイデア

このツールをベースに、以下のような拡張も可能です：

1. **型定義からプロパティ表を自動生成**
   - `Button.astro`のPropsインターフェースを解析
   - プロパティ一覧表を自動更新

2. **スクリーンショット自動生成**
   - Playwrightで各バリエーションを撮影
   - 仕様書に自動埋め込み

3. **仕様書品質チェック**
   - AIで仕様書をレビュー
   - 不足項目や矛盾を検出

4. **git差分連動**
   - コンポーネントが変更されたら通知
   - 仕様書の更新を促す

詳細は`docs/`の他のドキュメントを参照してください。

---

## まとめ

このツールを使うことで：

- ⏱️ **数時間→数分**: 仕様書作成時間を大幅短縮
- 📝 **網羅性**: PCアプリ外部仕様書に必要な項目を網羅
- 🎯 **具体性**: すぐに使えるコード例が自動生成
- 🔄 **一貫性**: プロジェクト全体で統一されたフォーマット

**まずは試してみましょう！**

```bash
npm run spec:generate "YourComponent" "あなたのコンポーネントの説明"
```
